---
layout: page
title: Setting Up Data Logging
section: Data Analysis
---
<div class="content2">

        <div class="content2-pagetitle">Setting Up Data Logging</div>

        <div class="content2-container line-box">
            <div class="content2-container-1col">



<p>This page presents the most essential step for data analyis, which is showing how to save the data from ports into log files. The <a href="reading_logfiles.html">next
page</a> will present how to read that data to analyze it.</p>

<h2 id="the-setup">The setup</h2>
<p>The following elements play a major role for logging in oroGen projects:</p>

<ul>
<li>a marshaller that is generated by oroGen,</li>
<li>a generic, high-performance, logging component that is able to log
any type that orogen understands.</li>
<li>finally, a command line tool to export the generated data, and a Ruby library that allows to manipulate the data in log files.</li>
</ul>

<p>The two most important features of that logging setup are that:
* it is very low overhead (see below), and
* generated log files are self-contained</p>

<p>That means that, once a log file has been generated, it can be read and analyzed even though you know absolutely nothing about the software that generated it.</p>

<h2 id="making-orogen-deployments-logging-ready">Making oroGen deployments logging-ready</h2>
<p>If you are using manually created deployments, the only step needed to make an
oroGen deployment &ldquo;ready to log&rdquo; is to add an add_default_logger statement to
your deployment specification. For instance:</p>

<pre><code class="language-ruby">deployment "test_imu" do
task "imu", "imu::Task"
add_default_logger
end
</code></pre>

<p>If you are using the model_name =&gt; task_name syntax in orocos.rb, as for
instance</p>

<pre><code class="language-ruby">Orocos.run 'xsens_imu::Task' =&gt; 'imu' do
end
</code></pre>

<p>then logging is already available.</p>

<h2 id="logging-all-output-ports-using-orocosrb">Logging all output ports using Orocos.rb</h2>
<p>If you are starting up your system using orocos.rb, the
simplest way to start logging is to add</p>

<pre><code class="language-ruby">Orocos.log_all
</code></pre>

<p>after all the deployments have been started. It will setup each deployment&rsquo;s
logger to log all output ports of the deployment. Additionally, it will setup a
log file storing the task&rsquo;s property values and their changes, for the
properties that are accessed from the Ruby process.</p>

<p>Port logs are stored in a &ldquo;name.<em>index</em>.log&rdquo; file, where name is the
deployment&rsquo;s name and <em>index</em> is incremented to avoid overwriting old log files
(i.e. name.0.log by default, but if name.0.log exists, then name.1.log and so
on). A complete example would be:</p>

<p>Property logs are all stored in a single file called &ldquo;properties.<em>index</em>.log&rdquo;.</p>

<p>How to extract data from the log files is the subject of the following
documentation pages.</p>

<pre><code class="language-ruby"># Start the test_imu deployment
Orocos.run 'xsens_imu::Task' =&gt; 'imu' do
# Set up logging
Orocos.log_all

# Start the IMU task
task = Orocos.name_service.get 'imu'
task.start

# Poll the task's states every 100 ms and report state changes.
Orocos.watch(task)
end
</code></pre>

<p>If you don&rsquo;t want to log some types, then use the exclude_types option. That
option takes a regular expression, all ports whose type matches that regex will
not be logged. For instance:</p>

<pre><code class="language-ruby">Orocos.log_all :exclude_types =&gt; /can\/Message/
</code></pre>

<p>will log all ports whose typename does not contain &ldquo;can/Message&rdquo;</p>

<h2 id="hand-made-logging-using-orocosrb">Hand-made logging using orocos.rb</h2>
<p>The logfile format is based on the following schema:
* the logger is multiplexing data streams into a
single file
* the logger component associates each of its input ports with a single stream in the file
* data coming on one of the input ports is saved into the associated stream</p>

<p>So, to log a port, you basically need to</p>

<ul>
<li>ask the logger to create a new stream along with an associated (input) port by using the createPort method</li>
<li>connect the output port you want to log to this new logger port.</li>
</ul>

<p>With orocos.rb, this is done with:</p>

<pre><code class="language-ruby">Orocos.run 'xsens_imu::Task' =&gt; 'imu' do
logger = Orocos.name_service.get 'imu_Logger'
imu    = Orocos.name_service.get 'imu'

logger.file = "logfile.log"

# Add a stream in the log file named "imu.orientation_samples", and connect
# the imu port to it with a buffer of size 200
logger.log(imu.orientation_samples, 200)

# Another way is to use the raw API on the logger task. createLoggingPort
# creates the stream on the log file as well ass the logger input. You just
# have to connect the output port to the logger's input
logger.createLoggingPort('orientations', '/base/samples/RigidBodyState', [])
imu.orientation_samples.connect_to(logger.orientations, :type =&gt; :buffer, :size =&gt; 200)

imu.configure
imu.start

# Don't forget to start your logger
logger.start
end
</code></pre>



            </div>
        </div>
    </div>
